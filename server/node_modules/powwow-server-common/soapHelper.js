var _ = require('underscore');
var soap = require('soap');

exports.jsonToXml = function(jsonObject, noNewLines) {
    var xml = "";
    if(_.isObject(jsonObject)) {
        var keys = Object.keys(jsonObject);
        for(var key of keys) {
            xml += "<" + key + ">" + exports.jsonToXml(jsonObject[key], noNewLines) + "</" + key + ">" + (noNewLines ? "" : "\n");
        }
    } else if(_.isArray(jsonObject)) {
        for(var i = 0; i < jsonObject.length; i++) {
            xml += exports.jsonToXml(jsonObject[i]);
        }
    } else { // is a primitive.
        xml += jsonObject;
    }
    return xml;
};

exports.soapRequest = function(wsdlFileOrUrl, apiCall, params) {
    return new Promise(function (resolve, reject) {
        soap.createClient(wsdlFileOrUrl, function (err, client) {
            if (err) {
                reject(err);
            } else {
                client[apiCall].call(client, params, function (err, result) {
                    if (err) {
                        reject(err);
                    } else {
                        resolve(result);
                    }
                });
            }
        });
    });
};
